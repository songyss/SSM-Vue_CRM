<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csi.mapper.SalesEmergencyMapper">

    <resultMap id="SalesEmergencyResultMap" type="com.csi.domain.SalesEmergency">
        <id property="id" column="id" />
        <result property="emergencyNo" column="emergency_no" />
        <result property="type" column="type" />
        <result property="salespersonId" column="salesperson_id" />
        <result property="customerId" column="customer_id" />
        <result property="relatedId" column="related_id" />
        <result property="title" column="title" />
        <result property="description" column="description" />
        <result property="customerRequest" column="customer_request" />
        <result property="urgency" column="urgency" />
        <result property="solutionContent" column="solution_content" />
        <result property="proposedBy" column="proposed_by" />
        <result property="costImpact" column="cost_impact" />
        <result property="riskLevel" column="risk_level" />
        <result property="status" column="status" />
        <result property="currentHandlerId" column="current_handler_id" />
        <result property="occurTime" column="occur_time" />
        <result property="deadline" column="deadline" />
        <result property="createdTime" column="created_time" />
        <result property="updatedTime" column="updated_time" />
        <result property="solvedTime" column="solved_time" />
        <result property="isDeleted" column="is_deleted" />
    </resultMap>

    <insert id="insert" parameterType="com.csi.domain.SalesEmergency" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sales_emergency (
            emergency_no, type, salesperson_id, customer_id, related_id, title,
            description, customer_request, urgency, solution_content, proposed_by,
            cost_impact, risk_level, status, current_handler_id, occur_time, deadline,
            created_time, updated_time
        ) VALUES (
                     #{emergencyNo}, #{type}, #{salespersonId}, #{customerId}, #{relatedId}, #{title},
                     #{description}, #{customerRequest}, #{urgency}, #{solutionContent}, #{proposedBy},
                     #{costImpact}, #{riskLevel}, #{status}, #{currentHandlerId}, #{occurTime}, #{deadline},
                     NOW(), NOW()
                 )
    </insert>

    <select id="selectById" parameterType="int" resultMap="SalesEmergencyResultMap">
        SELECT * FROM sales_emergency WHERE id = #{id} AND is_deleted = 0
    </select>

    <select id="selectBySalespersonId" parameterType="int" resultMap="SalesEmergencyResultMap">
        SELECT * FROM sales_emergency
        WHERE salesperson_id = #{salespersonId} AND is_deleted = 0
        ORDER BY created_time DESC
    </select>

    <update id="update" parameterType="com.csi.domain.SalesEmergency">
        UPDATE sales_emergency SET
                                   title = #{title},
                                   description = #{description},
                                   customer_request = #{customerRequest},
                                   urgency = #{urgency},
                                   solution_content = #{solutionContent},
                                   cost_impact = #{costImpact},
                                   risk_level = #{riskLevel},
                                   status = #{status},
                                   current_handler_id = #{currentHandlerId},
                                   deadline = #{deadline},
                                   updated_time = NOW()
        WHERE id = #{id}
    </update>

    <update id="deleteById" parameterType="int">
        UPDATE sales_emergency SET is_deleted = 1, updated_time = NOW() WHERE id = #{id}
    </update>

</mapper>